<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Play Youtube list</title>
  <style>
    body { font-family: system-ui, Arial, sans-serif; padding: 16px; max-width: 900px; margin: auto; }
    .grid { display: grid; grid-template-columns: 1fr 640px; gap: 16px; align-items: start; }
    textarea { width: 100%; height: 120px; }
    iframe { width: 100%; height: 360px; border: 0; background: #000; }
    ul { padding-left: 16px; }
    li { margin: 6px 0; }
    button { margin-left: 8px; }
  </style>
</head>
<body>
  <h1>Play Youtube list</h1>
  <p>Paste YouTube links or use pre-fill list</p>

  <div class="grid">
    <div>
      <label for="links">YouTube links (one per line):</label>
      <textarea id="links" placeholder="youtube link"></textarea>
      <div style="margin-top:8px;">
        <button id="load">Load list</button>
        <label style="margin-left:12px;"><input type="checkbox" id="autoplay" checked> Autoplay on select / advance</label>
      </div>

      <h3>Videos</h3>
      <ul id="list"></ul>
    </div>

    <div>
      <h3>Player</h3>
      <!-- The iframe will be controlled by the YouTube IFrame API -->
      <iframe id="player" src="about:blank" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
      <div style="margin-top:8px;">
        <button id="prev">Prev</button>
        <button id="next">Next</button>
        <span id="currentLabel" style="margin-left:8px"></span>
      </div>
    </div>
  </div>

  <!-- YouTube IFrame API -->
  <script src="https://www.youtube.com/iframe_api"></script>

  <script>
    // Parse YouTube video ID from multiple URL formats
    function extractVideoId(url) {
      if (!url) return null;
      // remove leading/trailing whitespace
      url = url.trim();
      // If user gives just an id
      if (/^[a-zA-Z0-9_-]{11}$/.test(url)) return url;
      try {
        const u = new URL(url);
        // youtube watch?v=ID
        if (u.hostname.includes('youtube.com')) {
          if (u.searchParams.has('v')) return u.searchParams.get('v');
          // /embed/ID or /v/ID
          const pathParts = u.pathname.split('/');
          return pathParts[pathParts.length - 1] || null;
        }
        // youtu.be/ID
        if (u.hostname === 'youtu.be') {
          return u.pathname.replace('/', '');
        }
      } catch (e) {
        // not a URL, maybe raw id
        if (/^[a-zA-Z0-9_-]{11}$/.test(url)) return url;
      }
      return null;
    }

    const linksEl = document.getElementById('links');
    const listEl = document.getElementById('list');
    const playerEl = document.getElementById('player');
    const loadBtn = document.getElementById('load');
    const autoplayChk = document.getElementById('autoplay');
    const prevBtn = document.getElementById('prev');
    const nextBtn = document.getElementById('next');
    const currentLabel = document.getElementById('currentLabel');

    let videos = []; // {id, title (url), raw}
    let currentIndex = -1;

    // YT API player instance (when available)
    let ytPlayer = null;
    let apiReady = false;

    // build fallback embed url (used if API not ready)
    function buildEmbedUrl(id, opts = {}) {
      const autoplay = opts.autoplay ? 1 : 0;
      const start = opts.start ? `&start=${opts.start}` : '';
      return `https://www.youtube-nocookie.com/embed/${id}?rel=0&autoplay=${autoplay}${start}&enablejsapi=1`;
    }

    function renderList() {
      listEl.innerHTML = '';
      videos.forEach((v, idx) => {
        const li = document.createElement('li');
        const a = document.createElement('a');
        a.href = '#';
        a.textContent = v.title || v.raw;
        a.addEventListener('click', (e) => {
          e.preventDefault();
          playIndex(idx);
        });
        li.appendChild(a);
        // small remove button
        const rm = document.createElement('button');
        rm.textContent = 'Remove';
        rm.addEventListener('click', (e) => {
          e.preventDefault();
          videos.splice(idx, 1);
          if (idx === currentIndex) {
            currentIndex = -1;
            if (ytPlayer && typeof ytPlayer.stopVideo === 'function') {
              ytPlayer.stopVideo();
            } else {
              playerEl.src = 'about:blank';
            }
            currentLabel.textContent = '';
          } else if (idx < currentIndex) {
            currentIndex--; // shift index
          }
          renderList();
        });
        li.appendChild(rm);
        listEl.appendChild(li);
      });
    }

    function playIndex(idx) {
      if (idx < 0 || idx >= videos.length) return;
      currentIndex = idx;
      const v = videos[idx];
      const autoplay = autoplayChk.checked;

      // If YT API ready, use it to load video (gives us events)
      if (apiReady && ytPlayer && typeof ytPlayer.loadVideoById === 'function') {
        try {
          // load the video by id
          ytPlayer.loadVideoById({ videoId: v.id, startSeconds: 0 });
          if (autoplay) {
            ytPlayer.playVideo();
          } else {
            ytPlayer.pauseVideo();
          }
        } catch (e) {
          // fallback to changing iframe src
          playerEl.src = buildEmbedUrl(v.id, { autoplay: autoplay ? 1 : 0 });
        }
      } else {
        // fallback: set iframe src directly (enablejsapi=1 added in URL)
        playerEl.src = buildEmbedUrl(v.id, { autoplay: autoplay ? 1 : 0 });
      }

      currentLabel.textContent = `${idx + 1} / ${videos.length}: ${v.title || v.raw}`;
      renderList();
    }

    // When YT API is ready it will call this global function
    function onYouTubeIframeAPIReady() {
      apiReady = true;
      ytPlayer = new YT.Player('player', {
        height: '360',
        width: '100%',
        videoId: '',
        playerVars: {
          rel: 0,
          autoplay: 0
        },
        events: {
          onStateChange: onPlayerStateChange,
          onError: onPlayerError
        }
      });
    }
    // expose globally (some bundlers/minifiers require explicit global)
    window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;

    function onPlayerError(e) {
      console.warn('YouTube player error', e);
    }

    function onPlayerStateChange(event) {
      // YT.PlayerState.ENDED === 0
      if (event.data === YT.PlayerState.ENDED) {
        // only advance automatically if the autoplay checkbox is checked
        if (autoplayChk.checked && videos.length > 0) {
          // advance to next (wrap-around)
          playIndex((currentIndex + 1) % videos.length);
        }
      } else if (event.data === YT.PlayerState.PLAYING) {
        // update label when the API reports playing (ensures correct title shown if changed)
        if (currentIndex >= 0 && currentIndex < videos.length) {
          const v = videos[currentIndex];
          currentLabel.textContent = `${currentIndex + 1} / ${videos.length}: ${v.title || v.raw}`;
          renderList();
        }
      }
    }

    loadBtn.addEventListener('click', () => {
      const lines = linksEl.value.split('\n').map(l => l.trim()).filter(Boolean);
      videos = lines.map(l => {
        const id = extractVideoId(l);
        return { id: id, raw: l, title: id ? (`https://youtu.be/${id}`) : l };
      }).filter(v => v.id); // discard invalid
      if (videos.length === 0) {
        alert('No valid YouTube links / IDs found.');
        return;
      }
      renderList();
      // auto-play first if checkbox set
      playIndex(0);
    });

    prevBtn.addEventListener('click', () => {
      if (videos.length === 0) return;
      playIndex((currentIndex - 1 + videos.length) % videos.length);
    });
    nextBtn.addEventListener('click', () => {
      if (videos.length === 0) return;
      playIndex((currentIndex + 1) % videos.length);
    });

    // Pre-fill list
    linksEl.value = [
      'https://www.youtube.com/watch?v=NRvTj2zM5Uw&list=RDNRvTj2zM5Uw&start_radio=1',
      'https://www.youtube.com/watch?v=WCgPzs2APw8&list=RDWCgPzs2APw8&start_radio=1',
      'https://www.youtube.com/watch?v=fcuWKpyUGHo&list=RDWCgPzs2APw8&index=5',
      'https://www.youtube.com/watch?v=D67jM8nO7Ag&list=RDWCgPzs2APw8&index=9',
      'https://www.youtube.com/watch?v=KJezMI2ibH0&list=RDWCgPzs2APw8&index=10',
      'https://www.youtube.com/watch?v=qOVLUiha1B8&list=RDWCgPzs2APw8&index=19',
      'https://www.youtube.com/watch?v=lS-BfZfBbvU&list=RDlS-BfZfBbvU&start_radio=1',
      'https://www.youtube.com/watch?v=gqELqRCnW6g&list=RDgqELqRCnW6g&start_radio=1',
      'https://www.youtube.com/watch?v=PWZylTw6RGY&list=RDPWZylTw6RGY&start_radio=1',
      'https://www.youtube.com/watch?v=OMv_EPMED8Y&list=RDOMv_EPMED8Y&start_radio=1',
      'https://www.youtube.com/watch?v=p9ZSZFwVqqc&list=RDp9ZSZFwVqqc&start_radio=1',
      'https://www.youtube.com/watch?v=rbBl5Jqs7ls&list=RDrbBl5Jqs7ls&start_radio=1',
      'https://www.youtube.com/watch?v=geCGtv-gQOc&list=RDgeCGtv-gQOc&start_radio=1',
      'https://www.youtube.com/watch?v=woLkMny_xDI&list=RDwoLkMny_xDI&start_radio=1',
      'https://www.youtube.com/watch?v=DP2vmsftZHY&list=RDDP2vmsftZHY&start_radio=1'
    ].join('\n');
  </script>
</body>
</html>
